   {{> user/header }}
<link href="/stylesheets/mobiscroll.javascript.min.css" rel="stylesheet" />
<script src="/javascripts/mobiscroll.javascript.min.js"></script>

<style>
  .nav-tabs {
    border-bottom: none !important;
  }

  button.owl-prev {
    position: absolute;
    left: 0px;
    top: 35%;
    transform: translateY(-50%);
    background-color: white !important;
    width: 20px;
    height: 20px;
    border-radius: 100% !important;
    color: #000 !important;
  }

  button.owl-next {
    position: absolute;
    right: 0px;
    top: 35%;
    transform: translateY(-50%);
    background-color: white !important;
    width: 20px;
    height: 20px;
    border-radius: 100% !important;
    color: #000 !important;
  }


  .owl-dots {
    display: none;
  }


  .item {
    display: flex;
    justify-content: center;

  }

  .item li {
    width: 100%;
    
  }

  .item li a {
  

    display: flex;
    align-items: center;
    justify-content: center;
    height: 55px;


    color: #000;
    text-transform: uppercase;
    flex-wrap: wrap;
    text-align: center;
    font-size: 16px;
    text-decoration: none;
    font-weight: 600;
  }

  .item li.active a {
      border-bottom: 3px solid #1977cc;
  }



  .tab-content {
    padding: 20px;
    background-color: #fff;
    font-size: 17px;
    text-align: center;
    line-height: 25px;
    margin-top: 30px;
    border-radius: 19px;
  }

  .tab-content h4 {
    font-size: 20px;
    font-weight: bold;
  }

  .section {
    padding: 100px 0;


  }

  .gray-bg {
    background-color: #f5f5f5;
  }

  img {
    max-width: 100%;
  }

  img {
    vertical-align: middle;
    border-style: none;
  }

  .about-avatar {
    max-width: 400px;
    border-radius: 10px;
    overflow: hidden;
  }

  /* About Me 
---------------------*/
  .about-text h3 {
    font-size: 45px;
    font-weight: 700;
    margin: 0 0 6px;
  }

  @media (max-width: 767px) {
    .about-text h3 {
      font-size: 35px;
    }
  }

  .about-text h6 {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 15px;
  }

  @media (max-width: 767px) {
    .about-text h6 {
      font-size: 18px;
    }
  }

  .about-text p {
    font-size: 18px;
    max-width: 450px;
  }

  .about-text p mark {
    font-weight: 600;
    color: #20247b;
  }

  .about-list {
    padding-top: 10px;
  }

  .about-list .media {
    padding: 5px 0;
  }

  .about-list label {
    font-size: 18px;
    color: #1977cc;
    font-weight: 600;
    width: 88px;
    margin: 0;
    position: relative;
  }

  .about-list p {
    margin: 0;
    font-size: 15px;
  }

  @media (max-width: 991px) {
    .about-avatar {
      margin-top: 30px;
    }
  }

  .about-section .counter {
    padding: 22px 20px;
    background: #ffffff;
    border-radius: 10px;
    box-shadow: 0 0 30px rgba(31, 45, 61, 0.125);
  }


  .modal-body input {
    outline: none;
    border: none;
    color: #444444;
  }

  .theme-color {
    color: #fc5356;
  }

  #schedDate{
    cursor: pointer;

  }
  .schedDate:hover{
    color: #1977cc !important;
  }

  .dark-color {
    color: #1977cc;
  }

  .fee-text {
    color: #fc5356 !important;
  }

  .btn-offpayment {
    width: 100%;
    background-color: #1977cc !important;
    color: #fff !important;
    font-size: 16px !important;
    font-weight: 500 !important;
  }

  .btn-onpayment {
    width: 100%;
    border: 2px solid #1977cc !important;
    ;
    color: #1977cc !important;
    font-size: 16px !important;
    font-weight: 500 !important;
  }

.scheduledate{
  text-align: center !important;
  font-size: 13px;
  padding: 5px 6px !important;
  background-color: #1977cc !important;
  color: #fff!important;
}
.scheduledateBKD{
   padding: 5px 6px !important;
   font-size: 13px;
  text-align: center !important;
  background-color: #a2a4a7 !important;
  color: #fff!important;
}
.mbsc-collapsible-content{
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  
}
  .modal-body {

    display: flex;
    justify-content: space-around !important;
  }
</style>






  <section class="patient-dash">
    <section class=" about-section gray-bg" id="about">
      <div class="container">
        <div class="row align-items-center flex-row-reverse">
          <div class="col-lg-6">
            <div class="about-text go-to">
              <h3 class="dark-color">{{doctor.firstname}} {{doctor.lastname}}</h3>
              <h6 class="theme-color lead">{{doctor.speciality}}</h6>
              <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Voluptate, nobis.</p>
              <div class="row about-list">
                <div class="col-md-6">
                  <div class="media">
                    <a class="text-success text-bold">Available<i class="ml-2 fas fa-check-circle"></i></a>
                   
                    <p></p>
                  </div>

                  <div class="media">
                    <label>Hospital</label>
                    <p>Mims Calicut</p>
                  </div>

                </div>
                <div class="col-md-6">
                  <div class="media">
                    <label>E-mail</label>
                    <p>{{doctor.email}}</p>
                  </div>

                  <div class="media">
                    <label>Skype</label>
                    <p>skype.0404</p>
                  </div>

                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="about-avatar">
              <img src="/images/uploads/{{doctor.profileImg}}" title="" alt="">
            </div>
          </div>
        </div>
   
        <div class="row mt-3">
             {{#each schedulesDate}}
             {{#if this.slots.length}}
        <div class="col-md-4">

    <div mbsc-accordion>

        <div mbsc-card data-collapsible>
            <div class="mbsc-card-header text-center" onclick="getDate('{{this.date}}','{{this._id}}')" >
              
                <a class="mbsc-card-title mbsc-bold schedDate"  id="schedDate" >{{this.date}}</a>
                <a class="slots d-none"  id="slots" >{{this.slots}}</a>
            </div>
            <div class="mbsc-card-content">
             
              {{#each this.slots}}
                    {{#if this.isBooked}}
                  <button  class="btn text-right   btn-sm scheduledateBKD" >
                  {{this.time}}</button> 
                  {{else}}
                 <button  class="btn text-right scheduledate  btn-sm" name="{{this._id}}" value=" {{this.time}}" data-toggle="modal"
                  id="scheduledate" data-target="#exampleModalCenter">
                  {{this.time}}</button> 
                  {{/if}}
            
                {{/each}}
            </div>
        </div>
    
    
    
    </div>

</div>
  {{/if}}
   {{/each}}
</div>
      </div>
    </section>


  </section>

  <!-- Modal -->
  <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Appointment Details</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body d-flex flex-column">

          <h6 class="modal-title">Patient Detaiils</h6>
          <hr>
          <form action="" id="makeBooking">
            <div class="row">
              <div class="media">
                <label>Patient Name :</label>
                <input class="ml-5" id="patientname" name="patientname" value="{{user.firstname}}" readonly>
              </div>

              <div class="media">
                <label>Date of Birth :</label>
                <input class="ml-5" id="DoB" name="DoB" value="{{user.DoB}}" readonly>

              </div>

              <div class="media">
                <label>Contact Number :</label>
                <input class="ml-5" id="mobile" name="mobile" value="{{user.mobile}}" readonly>

              </div> <input class="ml-5" id="patientId" name="patientId" value="{{user._id}}" hidden>
              <div class="media">
                <label>Address :</label>
                <input class="ml-5" id="address" name="address" value="{{user.address}}" readonly>

              </div>
              <hr>
              <h6 class="modal-title mb-3">Appointment Detaiils</h6>
              <hr>
              <div class="media">
                <label>Doctor Name :</label>
                <input class="ml-5" id="doctorname" name="doctorname" value="{{doctor.firstname}} {{doctor.lastname}}"
                  readonly>
                   <input class="ml-5" id="speciality" name="speciality" value="{{doctor.speciality}}"
                  hidden>
                <input class="ml-5" id="doctorId" name="doctorId" value="{{doctor._id}}" hidden>

              </div>
              <div class="media">
                
                <label>Appointment Date :</label>
                <p class="ml-5"></p>
                
                <input class="ml-5 schedDate" name="AppointmentDate" id="appointmentDate" readonly>
              <input class="ml-5 schedDate" name="AppointmentDateID" id="appointmentDateID" hidden>
              </div>
              <div class="media">
                <label>Consulting Fee :</label>
                <p class="ml-5 font-weight-bold">â‚¹</p>
                  
                <input class="font-weight-bold fee-text ml-2" name="fees" value="{{doctor.fees}}" id="fees" readonly>
                   
              </div>
              <div class="media">
                <label>Appointment Time :</label>
                <input class="ml-5" name="AppointmentTime" id="appointmentTime" readonly>

              </div>


            </div>

            <div class="row paymentbox mt-3">
              <h6 class="modal-title mb-3">Choose Payment Method</h6>

              <div class="col-lg-6 ">
                <button type="submit" id="online" value="online" name="payment-method"
                  class="btn btn-onpayment paymentMethod">Online Payment</button>
                <br>
                <small class="ml-2">*No extra charges</small>
              </div>
              <div class="col-lg-6">
                <button value="offline" id="offline" type="submit" name="payment-method"
                  class="btn btn-offpayment paymentMethod">Payment at Hospital</button>
              </div>
            </div>

          </form>

        </div>

        <div class="modal-footer">


        </div>
      </div>
    </div>
  </div>

  {{> user/footer}}
<script>

    mobiscroll.settings = {
        lang: 'en',            // Specify language like: lang: 'pl' or omit setting to use default
        theme: 'ios',          // Specify theme like: theme: 'ios' or omit setting to use default
        themeVariant: 'light'  // More info about themeVariant: https://docs.mobiscroll.com/4-10-10/javascript/cards#opt-themeVariant
    }
    
    var collapsibles = document.querySelectorAll('[data-collapsible]');
    
    mobiscroll.listview('.md-contact-list', {
        swipe: false,
        enhance: true
    })
    
    document
        .getElementById('close-all')
        .addEventListener('click', function () {
            for (var i = 0; i < collapsibles.length; ++i) {
                mobiscroll.instances[collapsibles[i].id].hide();
            }
        })

    document
        .getElementById('toggle-last')
        .addEventListener('click', function () {
            mobiscroll.instances[collapsibles[3].id].toggle();
        })
</script>
  <script>
  function getDate (date,dateID) {

 $("#appointmentDate").val(date)
$("#appointmentDateID").val(dateID)


    $(document).on('click', '.scheduledate', function (e) {
      e.preventDefault()
          let slotTime = $(this).val()
          let slotId = $(this).attr("name")
console.log(slotTime)
console.log(slotId)
      $("#appointmentTime").val(slotTime)

      $(document).on('click', '.btn-offpayment', function (e) {
        /*$("#makeBooking").submit((e)=>{*/

        e.preventDefault()
        const patientname = $("#patientname").val()
        const DoB = $("#DoB").val()
        const mobile = $("#mobile").val()
        const address = $("#address").val()
        const doctorname = $("#doctorname").val()
        const speciality = $("#speciality").val()
     
        const appointmentDate =  date
       const appointmentTime = slotTime
       const dateId = $("#appointmentDateID").val()
        const fees = $("#fees").val()
        const doctorId = $("#doctorId").val()
        const patientId = $("#patientId").val()
        const paymentmethod = "Offline"

console.log(dateID)
console.log(date)

        $.ajax({
          type: "POST",
          url: "/make-booking",

          data: {
            patientname,
            DoB,
            mobile,
            address,
            doctorname,
            speciality,
            appointmentDate,
            appointmentTime,
          slotId,
            dateId,
            patientId,
            doctorId,
            paymentmethod,
            fees
          },
          success: (response) => {
            if (response.offlineSuccess) {
              location.href = "/book-success"
            }

          }
        })
      }
      )
      $(document).on('click', '.btn-onpayment', function (e) {
        /*$("#makeBooking").submit((e)=>{*/

        e.preventDefault()
      const patientname = $("#patientname").val()
        const DoB = $("#DoB").val()
        const mobile = $("#mobile").val()
        const address = $("#address").val()
        const doctorname = $("#doctorname").val()
        const appointmentDate =  date
       const appointmentTime = slotTime
          const dateId = $("#appointmentDateID").val()
        const speciality = $("#speciality").val()
        const fees = $("#fees").val()
        const doctorId = $("#doctorId").val()
        const patientId = $("#patientId").val()
        const paymentmethod = "Online"


        $.ajax({

          url: "/make-booking",
          type: "POST",
          data: {
            patientname,
            DoB,
            mobile,
            address,
            doctorname,
            slotId,
            speciality,
            appointmentDate,
            appointmentTime,
            patientId,
            dateId,
            doctorId,
            paymentmethod,
            fees
          },
          success: (response) => {

            razorpayPayment(response)
          }
        })
$('#modal').modal(toggle)
      }
      )
    })

 }
    function razorpayPayment(appointment) {

      var options = {
        "key": "rzp_test_OvzO3gvb52xtOP", // Enter the Key ID generated from the Dashboard
        "amount": appointment.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
        "currency": "INR",
        "name": "MediLab",
        "description": "Test Transaction",
        "image": "https://example.com/your_logo",
        "order_id": appointment.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
        "handler": function (response) {

          verifyPayment(response, appointment)
        },
        "prefill": {
          "name": "Gaurav Kumar",
          "email": "gaurav.kumar@example.com",
          "contact": "9999999999"
        },
        "notes": {
          "address": "Razorpay Corporate Office"
        },
        "theme": {
          "color": "#1977cc"
        }
      };
      var rzp1 = new Razorpay(options);
      rzp1.open();
    }
    function verifyPayment(payment, appointment) {
      $.ajax({
        url: '/verify-payment',
        type: 'POST',
        data: {
          payment,
          appointment
        },
        success: function (response) {
          if (response.status) {
            location.href = "/book-success"
          }
        }
      })
    }

  </script>

<script>
  let slotTime = $(".scheduledate").val()
 
   
      console.log(slotTime)
   

</script>
